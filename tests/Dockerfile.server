FROM gcc:latest

COPY . /quic-nfs
WORKDIR /quic-nfs

RUN ./install_dependencies

WORKDIR /quic-nfs
# create a directory for export
RUN mkdir -p /nfs_share
# mark /nfs_share as exported
RUN touch exports && \
    echo "/nfs_share *(rw)" > ./exports

# create some files and directories for testing purposes
RUN touch /nfs_share/test_file.txt && \
    echo "test_content" >> /nfs_share/test_file.txt
RUN touch /nfs_share/a.txt && \
    echo "a" >> /nfs_share/a.txt

RUN mkdir /nfs_share/write_test
RUN touch /nfs_share/write_test/write_test_file.txt && \
    echo "write_test_content" >> /nfs_share/write_test/write_test_file.txt

RUN mkdir /nfs_share/create_test

RUN mkdir -p /existent_but_non_exported_directory
RUN echo "/exported_but_non_existent_directory *(rw)" >> ./exports

RUN chmod +x ./build/mount_and_nfs_server
CMD ["./build/mount_and_nfs_server"]